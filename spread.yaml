project: spread-images

environment:
    PROJECT_PATH: /root/spread-images
    TESTSLIB: $PROJECT_PATH/lib

backends:
    linode:
        key: "$(HOST: echo $SPREAD_LINODE_KEY)"
        systems:
            - ubuntu-16.04-64:
                kernel: GRUB 2
            - ubuntu-16.04-32:
                kernel: GRUB 2
            - ubuntu-16.10-64:
                kernel: GRUB 2
            - ubuntu-17.04-64:
                kernel: GRUB 2
            - ubuntu-17.10-64:
                kernel: GRUB 2
            - debian-9-64:
                kernel: GRUB 2
            - debian-sid-64:
                kernel: GRUB 2
            - fedora-25-64
            - fedora-26-64:
                kernel: GRUB 2
            - fedora-27-64:
                kernel: GRUB 2
            - fedora-rawhide-64
            - opensuse-42.2-64

path: /root/spread-images

restore: |
    case "$SPREAD_SYSTEM" in
        ubuntu-*|debian-*)
            apt autoremove -y
            find \
                /var/log \
                /var/cache/apt \
                /var/lib/apt/{lists,mirrors} \
                -type f -exec rm -f {} \;
            ;;
        fedora-*)
            dnf -q -y autoremove
            find \
                /var/log \
                /var/cache/dnf \
                /var/lib/dnf/{history,yumdb} \
                -type f -exec rm -f {} \;
            ;;
        opensuse-*)
            find \
                /var/log \
                /var/cache/zypper \
                -type f -exec rm -f {} \;
            ;;
        *)
            echo "ERROR: Unsupported distribution '$SPREAD_SYSTEM'"
            exit 1
            ;;
    esac

    rm -rf \
        /root/.bash_history \
        /root/.viminfo \
        /root/.bashrc \
        /root/.cache \
        /root/spread \
        /root/spread-images

suites:
    tasks/:
        summary: Image maintenace tasks
